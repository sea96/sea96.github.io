<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="分块大法好！"/>




  <meta name="keywords" content="数据结构,平方分割," />




  <link rel="alternate" href="/atom.xml" title="清逸">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="https://sea96.github.io/2017/03/21/平方分割/"/>


<meta name="description" content="分块大法好！">
<meta property="og:type" content="article">
<meta property="og:title" content="平方分割">
<meta property="og:url" content="https://sea96.github.io/2017/03/21/平方分割/index.html">
<meta property="og:site_name" content="清逸">
<meta property="og:description" content="分块大法好！">
<meta property="og:updated_time" content="2017-05-13T14:07:09.933Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="平方分割">
<meta name="twitter:description" content="分块大法好！">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />





<script>
  var CONFIG = {
    search: true,
    searchPath: "/search.xml",
    fancybox: true,
    toc: true,
  }
</script>




  



    <title> 平方分割 · 清逸 </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  <link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="mobile-header-logo">
    <a href="/." class="logo">清逸</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags/">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/about/">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">清逸</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            
            
              关于
            
          </a>
        </li>
      
      
        <li class="menu-search">
          <form>
            <i class="iconfont icon-search" id="open-search"></i>
            <input type="text" class="search-input" id="search-input" />
            <i class="iconfont icon-close" id="close-search"></i>
          </form>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          平方分割
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Mar 21, 2017
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对序列平方分割"><span class="toc-text">对序列平方分割</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目"><span class="toc-text">题目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#POJ-2104-K-th-Number"><span class="toc-text">POJ 2104 K-th Number</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UVA-12003-Array-Transformer"><span class="toc-text">UVA 12003 Array Transformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BZOJ-2957-楼房重建"><span class="toc-text">BZOJ 2957 楼房重建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDOJ-4366-Successor"><span class="toc-text">HDOJ 4366 Successor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BZOJ-2002-Bounce-弹飞绵羊"><span class="toc-text">BZOJ 2002 Bounce 弹飞绵羊</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CodeForces-551E-GukiZ-and-GukiZiana"><span class="toc-text">CodeForces 551E GukiZ and GukiZiana</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CodeForces-444C-DZY-Loves-Colors"><span class="toc-text">CodeForces 444C DZY Loves Colors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CodeChef-QCHEF-Chef-and-Problems"><span class="toc-text">CodeChef QCHEF Chef and Problems</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LYOI-147-「分块」区间众数"><span class="toc-text">LYOI 147 「分块」区间众数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CodeForces-455D-Serega-and-Fun"><span class="toc-text">CodeForces 455D Serega and Fun</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-4391-Paint-The-Wall"><span class="toc-text">HDU 4391 Paint The Wall</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对集合平方分割"><span class="toc-text">对集合平方分割</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目-1"><span class="toc-text">题目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-4858-项目管理"><span class="toc-text">HDU 4858 项目管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-4467-Graph"><span class="toc-text">HDU 4467 Graph</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZOJ-3749-Chameleon"><span class="toc-text">ZOJ 3749 Chameleon</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对询问平方分割"><span class="toc-text">对询问平方分割</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><hr>
<p>平方分割又叫做分桶法或者分块法，把排成一排的 $N$ 个元素每 $\sqrt N $ 分在一个块（桶）里，这样的分割方法可以把对区间的操作的复杂度降至 $O(\sqrt N)$。</p>
<h2 id="对序列平方分割"><a href="#对序列平方分割" class="headerlink" title="对序列平方分割"></a>对序列平方分割</h2><hr>
<p>一般的做法是预设一个整数$S$（$S=\lceil \sqrt {N} \rceil$），将序列分成$B（B=\lceil \frac{N}{S} \rceil）$块，每块$S$个元素。对于一个区间的操作分为块内操作和块间操作，块内的暴力求解，块间的高效求解（排序后二分，lazy标记，预处理，数据结构维护等）。</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//定义块号和块边界</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    belong<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">/</span> S<span class="token punctuation">;</span>
    L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> belong<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>S<span class="token punctuation">;</span>
    R<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>S<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//区间询问或区间修改</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>l<span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>r<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//need efficient algorithm</span>
        i <span class="token operator">=</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//just use brute force</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><h4 id="POJ-2104-K-th-Number"><a href="#POJ-2104-K-th-Number" class="headerlink" title="POJ 2104 K-th Number"></a><a href="http://poj.org/problem?id=2104" target="_blank" rel="external">POJ 2104 K-th Number</a></h4><p>题意<br>有$n$个数字，$m$次询问，询问$[l,r]$区间里第$k$大的数字。<br>题解<br>这题是主席树的经典题目，在本文中尝试用分块的方法求解。<br>对元素的位置分块，每块分别排好序，二分第$k$大的数字$v$，对于一个区间$[l,r]$查询小于$v$的个数分为块内查询和块间查询，块内元素一个一个判断是否小于$v$；块间用二分查找来统计小于$v$的个数。<br>二分复杂度：$O(logN)$，单次查询复杂度：$O(S+BlogS)$<br>总时间复杂度：$O(M(logN(S+BlogS)))$<br><a href="http://paste.ubuntu.com/24285945/" target="_blank" rel="external">code</a></p>
<h4 id="UVA-12003-Array-Transformer"><a href="#UVA-12003-Array-Transformer" class="headerlink" title="UVA 12003 Array Transformer"></a><a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=3154" target="_blank" rel="external">UVA 12003 Array Transformer</a></h4><p>题意<br>有一个数组$A[1,…,n]$和$m$条指令和一个数字$u$，每条指令形如$(l,r,v,p)$，统计出$A[l],A[l+1],…,A[r]$中严格小于$v$的元素的个数为$k$，然后把$A[p]$改为$\frac {u<em>k}{r-l+1}$。问变换后的最终数组。<br>题解<br>对元素的位置分块，每块分别排序。询问的操作同<code>POJ 2104</code>，修改的操作则在$p$所在的块里进行，因为修改后块内元素基本有序，所以用 <em>*插入排序</em></em> 的方法使得被修改的元素移动到正确的位置。<br>单次修改的复杂度：$O(logS+S)$，单次查询的复杂度：$O(S+BlogS)$<br>总时间复杂度：$O(M(S+BlogS))$<br>类题：<a href="http://www.spoj.com/problems/RACETIME/en/" target="_blank" rel="external">SPOJ RACETIME Race Against Time</a><br><a href="http://paste.ubuntu.com/24225925/" target="_blank" rel="external">code</a><br>拓展<br>若本题修改不是单点修改，而是区间修改，那么也没有必要重新全部排序：</p>
<blockquote>
<p>本来数组是有序的，现在把其中一部分加上了一个数，那么可以将原数组分为修改后的和没修改的两部分，每部分都是一个有序数组，可以在 $O(S )$  的时间内 <strong>归并排序</strong>。  ——《非常规大小分块算法初探》 徐明宽</p>
</blockquote>
<h4 id="BZOJ-2957-楼房重建"><a href="#BZOJ-2957-楼房重建" class="headerlink" title="BZOJ 2957 楼房重建"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2957" target="_blank" rel="external">BZOJ 2957 楼房重建</a></h4><p>题意<br>一个人在坐标(0,0)看楼房，楼房定义为$(x_i,y_i)$表示位置在$x_i$，高度为$y_i$。如果这栋楼房上任何一个高度大于0的点与(0,0)的连线没有与之前的线段相交，那么这栋楼房就被认为是可见的。起初所有楼房的高度都为0，有M次操作，每次修改某个楼房的高度，问每次操作结束后能从(0,0)看到多少栋楼房。<br>题解<br>如果一栋楼房可见，那么最高点$(x_i,y_i)$和(0,0)在x轴上的斜率一定大于前面所有的楼房，也就是要求斜率单调递增的序列的长度。<br>对楼房的位置分块，每个块维护斜率递增的序列。修改操作直接在某个块上重新计算斜率递增的序列（可以使用插入排序算法），查询操作在每个块里二分查找大于前一个块里的最大斜率的斜率，并更新当前最大斜率。<br>单次修改复杂度：$O(S)$，单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(BlogS+S))$<br><a href="http://paste.ubuntu.com/24226008/" target="_blank" rel="external">code</a></p>
<h4 id="HDOJ-4366-Successor"><a href="#HDOJ-4366-Successor" class="headerlink" title="HDOJ 4366 Successor"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4366" target="_blank" rel="external">HDOJ 4366 Successor</a></h4><p>题意<br>有$n$个人，编号为0的是老板，编号1到$n-1$是员工，每个员工只有一个上司，除老板为每个人有他的忠诚值和能力值。每次要解雇一个人的时候，从他的下属中选取能力值大于他的且忠诚值最高的一个，若不存在则输出-1。共$m$次询问，每次询问解雇编号为i的员工会选择哪个编号的员工顶替他。（所有询问都不相互影响）<br>题解<br>显然是一棵树，用DFS序得到编号的序列，每个点能知道子树在序列上对应的区间。对序列分块，每块的元素按照能力值排序，简单的dp求得能力值更大的后缀里忠诚值的最大值。块内查询逐个遍历，块间查询二分查找大于解雇员工的能力值的位置，从而得到最大的忠诚值，又因为忠诚值互不相同，所以能用map对应到员工的编号。<br>单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(BlogS))$<br><a href="http://paste.ubuntu.com/24226267/" target="_blank" rel="external">code</a></p>
<h4 id="BZOJ-2002-Bounce-弹飞绵羊"><a href="#BZOJ-2002-Bounce-弹飞绵羊" class="headerlink" title="BZOJ 2002 Bounce 弹飞绵羊"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2002" target="_blank" rel="external">BZOJ 2002 Bounce 弹飞绵羊</a></h4><p>题意<br>有$n$个弹力装置，每个装置有一个弹力系数$k_i$，如果绵羊到达第$i$个装置，它会被弹到第$i+k_i$个装置。有$m$个操作，修改某个装置的弹力系数，或者询问从某个装置出发弹几次后会被弹飞。<br>题解<br>对装置的位置分块，预处理出每个块维护从块里每个位置出发要弹几次后弹出该块，以及弹出后到达的位置。修改操作直接在某个块上重新计算要维护的信息，查询操作利用每个块的信息可以$O(1)$跳出该块，累计次数和即可。<br>单次修改复杂度：$O(S)$，单次查询复杂度：$O(B)$<br>总时间复杂度：$O(M(S+B))$<br><a href="http://paste.ubuntu.com/24226169/" target="_blank" rel="external">code</a><br>拓展<br>本题的加强版：<a href="http://codeforces.com/problemset/problem/13/E" target="_blank" rel="external">CodeForces 13E Holes</a><br>增加单点修改的操作以及询问最后被弹飞的位置。<br>做法类似，预处理中增加从块里每个位置出发最后弹出该块的位置<br><a href="http://paste.ubuntu.com/24286071/" target="_blank" rel="external">code</a></p>
<h4 id="CodeForces-551E-GukiZ-and-GukiZiana"><a href="#CodeForces-551E-GukiZ-and-GukiZiana" class="headerlink" title="CodeForces 551E GukiZ and GukiZiana"></a><a href="http://codeforces.com/problemset/problem/551/E" target="_blank" rel="external">CodeForces 551E GukiZ and GukiZiana</a></h4><p>题意<br>有$n$个数字，$m$次操作：1. $[l,r]$区间里的所有数字都增加$x$；2. 询问$[1,n]$里的最远点对$(i,j)$满足$a_i=a_j=y$。<br>题解<br>类似线段树的区间修改，对每一个块添加lazy标记表示该块统一增加的总和。每块分别把$pair(a[i],i)$排好序，若块内元素被修改则重新排序，询问时只要对所有的块二分$(y-lazy[b])$求出最近左端点和最远右端点即可。<br>单次修改复杂度：$O(SlogS+B)$，单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(SlogS+BlogS))$<br><a href="http://paste.ubuntu.com/24286489/" target="_blank" rel="external">code</a></p>
<h4 id="CodeForces-444C-DZY-Loves-Colors"><a href="#CodeForces-444C-DZY-Loves-Colors" class="headerlink" title="CodeForces 444C DZY Loves Colors"></a><a href="http://codeforces.com/problemset/problem/444/C" target="_blank" rel="external">CodeForces 444C DZY Loves Colors</a></h4><p>题意<br>有$n$个数字，第$i$个数字$a[i]=i$，有$m$次操作：1. 修改$[l,r]$区间的数字为$x$，设原来的值为$y$，那么该位置改变量累加$|x-y|$；2. 询问$[l,r]$区间的改变量的总和。<br>题解<br>对每一个块设置lazy标记表示该块的相同的值（如果不相同则标记为0），$sum[i]$表示第i个数字非lazy修改（即直接单点修改）的改变量和，$sum_{lazy}[b]$表示第$b$块里每一个数字经lazy修改的改变量和，$sum_{block}[b]$表示第b块经lazy修改的所有数字的改变量总和。每次区间修改最多出现两个没有lazy标记的块，所以需要暴力单点更新的块不会很多。块内询问每个数字的贡献值总和：$\sum (sum[i]+sum_{lazy}[b])$；块间询问每个块的贡献值总和：$\sum sum_{block}[b]$。<br>单次修改复杂度：$O(S+B)$，单次查询复杂度：$O(S+B)$<br>总时间复杂度：$O(M(S+B))$<br><a href="http://paste.ubuntu.com/24286192/" target="_blank" rel="external">code</a></p>
<h4 id="CodeChef-QCHEF-Chef-and-Problems"><a href="#CodeChef-QCHEF-Chef-and-Problems" class="headerlink" title="CodeChef QCHEF Chef and Problems"></a><a href="https://www.codechef.com/problems/QCHEF" target="_blank" rel="external">CodeChef QCHEF Chef and Problems</a></h4><p>题意<br>有$N$个数字，第$i$个数字$A[i] \leq M$，$K$次询问：问在$[L,R]$中相同数字的位置的最大间隔。<br>题解<br>由于没有修改操作，可以预处理一些信息来辅助求解。<br>对序列分块之后进行预处理：<br>块间预处理：$ans[i][j]$表示第$i$块到第$j$块区间里的最大间隔，通过$pre$数组记录每个数字最早出现的位置实现。然后就可以$O(1)$得到块间最大值。<br>块内预处理：$pos_0[b][v]$表示第$b$块里$v$最后出现的位置，然后转为前$b$块的最后出现的位置；同理可得$pos_1[b][v]$表示第$b$块之后$v$最早出现的位置。然后暴力求解即可，求解方法和块间预处理相同。<br>块间预处理复杂度：$O(BN)$，块内预处理复杂度：$O(N+BM)$<br>总时间复杂度：$O(BN+BM+KS)$<br><a href="http://paste.ubuntu.com/24497476/" target="_blank" rel="external">code</a><br>类题：<a href="http://www.spoj.com/problems/ZQUERY/en/" target="_blank" rel="external">SPOJ ZQUERY Zero Query</a>（提示：求前缀和）</p>
<h4 id="LYOI-147-「分块」区间众数"><a href="#LYOI-147-「分块」区间众数" class="headerlink" title="LYOI 147 「分块」区间众数"></a><a href="https://ly.men.ci/problem/147" target="_blank" rel="external">LYOI 147 「分块」区间众数</a></h4><p>题意<br>给一个长度为 $n$ 的序列，$m$ 次询问，每次查询一个区间 $[l,r]$ 内的众数（如果有多个众数，取最小的一个），强制在线。<br>题解<br>同样没有修改操作，类似上题预处理一些信息。<br>对序列离散化，分块之后进行预处理：<br>块间预处理：$ans[i][j]$表示第$i$块到第$j$块区间的众数，通过$cnt$数组记录每个数字出现次数实现。然后就可以$O(1)$得到块间最大值。<br>块内预处理：$sum[b][v]$表示第$b$块里$v$出现的次数，然后转为前$b$块的出现的次数。然后暴力求解即可，求解方法和块间预处理相同。<br>块间预处理复杂度：$O(BN)$，块内预处理复杂度：$O(N+BN)$<br>总时间复杂度：$O(BN+S)$<br><a href="http://paste.ubuntu.com/24497549/" target="_blank" rel="external">code</a><br>拓展<br>带修改操作：<a href="http://www.docin.com/p-679227660.html" target="_blank" rel="external">区间众数解题报告 - 陈立杰</a></p>
<h4 id="CodeForces-455D-Serega-and-Fun"><a href="#CodeForces-455D-Serega-and-Fun" class="headerlink" title="CodeForces 455D Serega and Fun"></a><a href="http://codeforces.com/problemset/problem/455/D" target="_blank" rel="external">CodeForces 455D Serega and Fun</a></h4><p>题意<br>有 $n$ 个数字，$q$ 次操作，1. 序列循环向右移动一位；2. 询问 $[l,r]$ 里 $k$ 的个数。强制在线。<br>题解<br>使用块状链表解决：<br>用<code>deque</code>或者<code>list</code>存储每块的元素，移位操作在每块 $O(1)$ 地插入或删除。<br>预处理出每块中每个元素的个数，移位时也可以 $O(1)$ 修改。<br>总时间复杂度：$O(Q(B+S))$<br><a href="http://paste.ubuntu.com/24502543/" target="_blank" rel="external">code</a></p>
<h4 id="HDU-4391-Paint-The-Wall"><a href="#HDU-4391-Paint-The-Wall" class="headerlink" title="HDU 4391 Paint The Wall"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4391" target="_blank" rel="external">HDU 4391 Paint The Wall</a></h4><p>题意<br>有 $n$ 个数字，$q$ 次操作，1. 将 $[l,r]$ 里的所有元素涂成颜色 $z$；2. 询问 $[l,r]$ 里 颜色 $z$ 的个数。<br>题解<br>颜色范围很大，如果使用朴素的线段树空间上无法承受。<br>线段树套分块哈希：考虑线段树维护的不是单个元素，而是整块元素，每块用 <code>map</code> 维护每种颜色的数量，再加上懒惰标记后可以通过此题。<br>总时间复杂度：$O(Q(B+SlogS)$<br><a href="http://paste.ubuntu.com/24502639/" target="_blank" rel="external">code</a></p>
<h2 id="对集合平方分割"><a href="#对集合平方分割" class="headerlink" title="对集合平方分割"></a>对集合平方分割</h2><hr>
<p>通常在图中使用，具体做法是预设一个整数$S$（$S=\lceil \sqrt {E} \rceil$），将度数超过 $S$ 的点记为<strong>重点</strong>，其余的点记为<strong>轻点</strong>。重新建图：<strong>重点</strong>只与相邻的<strong>重点</strong>连边，<strong>重点</strong>与相邻的<strong>轻点</strong>的边的信息使用预处理或者数据结构等手段高效维护，使得对点的遍历和边的修改的复杂度降至 $O(\sqrt E)$。</p>
<h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><h4 id="HDU-4858-项目管理"><a href="#HDU-4858-项目管理" class="headerlink" title="HDU 4858 项目管理"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4858" target="_blank" rel="external">HDU 4858 项目管理</a></h4><p>题意<br>有 $n$ 个点，$m$ 条边的无向无环图，两个节点可能有多条边，每条点有权值，有 $q$ 次操作，1. 节点 $u$ 的权值加上 $v$；2. 问节点 $u$ 相邻点的权值和。<br>题解<br>根据<strong>重点</strong>和<strong>轻点</strong>的定义，将原图重新建图，若 $u$ 是重点，$sum[u]$ 保存与 $u$ 相邻的 <strong>重点</strong> 的权值和。修改 <strong>重点</strong> 的话更新该点和与该点相邻的 <strong>重点</strong> 的$sum$（单次修改复杂度：$O(S)$；单次查询复杂度：$O(1)$），否则在原图遍历所有相邻点的 $sum$（单次修改复杂度：$O(S)$；单次查询复杂度：$O(S)$）。<br>总时间复杂度：$O(QS)$<br><a href="http://paste.ubuntu.com/24554157/" target="_blank" rel="external">code</a></p>
<h4 id="HDU-4467-Graph"><a href="#HDU-4467-Graph" class="headerlink" title="HDU 4467 Graph"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4467" target="_blank" rel="external">HDU 4467 Graph</a></h4><p>题意<br>有 $n$ 个点，$m$ 条边的无向无环图，每条边有权值 $w$，每个点有颜色 $(0/1)$，有 $q$ 次操作，1. 第 $x$ 个点的颜色反转；2. 问端点的颜色是 $(A,B)$ 的边的权值和。（$A(B)=0/1$）<br>题解<br>根据<strong>重点</strong>和<strong>轻点</strong>的定义，将原图重新建图，预处理若干信息，若 $u$ 是 <strong>重点</strong>，$sum[u][0/1]$ 保存与 $u$ 相邻的 <strong>重点（轻）点</strong> 的边权和，$ans[k]$(k=0: <code>0-0</code>; k=1: <code>0-1</code>; k=2: <code>1-1</code>) 保存统一类型的边权总和，修改只要交换信息即可，查询能 $O(1)$ 得到答案。<br><a href="http://paste.ubuntu.com/24523491/" target="_blank" rel="external">code</a></p>
<h4 id="ZOJ-3749-Chameleon"><a href="#ZOJ-3749-Chameleon" class="headerlink" title="ZOJ 3749 Chameleon"></a><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemCode=3749" target="_blank" rel="external">ZOJ 3749 Chameleon</a></h4><p>题意<br>有 $n$ 个集合，第 $i$ 个集合有 $m_i$ 个数字，所有数字都不相同，$q$ 次操作，每次选取第 $i$ 个集合和第 $j$ 个集合，按照数字大小归并排序，问排序后相邻数字之间所属集合不同的个数。<br>题解<br>按照朴素的方法，复杂度是 $O(QN)$。按照集合的大小以 $S=\sqrt N$ 分类，两个集合都小于 $S$ 的询问按照朴素的方法解决，复杂度为 $O(QS)$；如果大于$S$，考虑离线询问，对于一个大于 $S$ 的集合，$O(N)$ 处理出其他所有集合和它的答案，那么复杂度为 $O(NS)$。总时间复杂度：$O((N+Q)S)$<br><a href="http://paste.ubuntu.com/24557908/" target="_blank" rel="external">code</a></p>
<p>CodeForces 348C     Subset Sums 对集合<br>CodeForces 576C     Points on Plane 对集合<br>CodeForces 398D Instant Messanger 对集合</p>
<h2 id="对询问平方分割"><a href="#对询问平方分割" class="headerlink" title="对询问平方分割"></a>对询问平方分割</h2><hr>
<p>莫队算法用到了分块的思想，一般是给$Q$个区间$[l,r]$来进行的一些操作和询问。<br>将序列分成$\sqrt N $块，每块的大小为$\sqrt N $。离线处理$Q$个区间：首先对左端点$l$所在的块号从小到大排序，如果块号相同则按右端点$r$从小到大排序。然后用双指针移动到当前区间位置，每次移动更新对结果的贡献。</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>Q<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>L <span class="token operator">&lt;</span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">)</span> <span class="token function">sub</span><span class="token punctuation">(</span>L<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//删除</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>L <span class="token operator">></span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">--</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//增加</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>R <span class="token operator">&lt;</span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">++</span>R<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>R <span class="token operator">></span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token function">sub</span><span class="token punctuation">(</span>R<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ans<span class="token punctuation">[</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//答案</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="http://codeforces.com/contest/86/problem/D" target="_blank" rel="external">CF 86D Powerful array</a></p>
<p>CodeForces 351D Jeff and Removing Periods 莫队<br>HDU 4638 Group 莫队<br>CodeForces 103D Time to Raid Cowavans 莫队<br>CodeForces 375D Tree and Queries  莫队<br>CodeForces 617E    XOR and Favorite Number 莫队<br>SPOJ DQUERY    D-query 莫队<br>CodeChef GERALD07 Chef and Graph Queries 莫队，并查集，LCT<br>CodeChef IITI15    Sherlock and Inversions 莫队，区间逆序对</p>

      
    </div>

    
      
      



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.jpg" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/数据结构/">数据结构</a>
            
              <a href="/tags/平方分割/">平方分割</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/03/23/Egyptian-Collegiate-Programming-Contest-ECPC-2015/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Egyptian Collegiate Programming Contest (ECPC 2015)</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/03/20/AtCoder-Regular-Contest-070/">
        <span class="next-text nav-default">AtCoder Regular Contest 070</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:hai96626@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/sea96" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">清逸</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://sea96.github.io/2017/03/21/平方分割/';
        this.page.identifier = '2017/03/21/平方分割/';
        this.page.title = '平方分割';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//harrypoker.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>

  




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  <script type="text/html" id="search-result">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">
          <a href="$url$" class="post-link">
            $title$
          </a>
        </h1>
      </header>
      <div class="post-content">
        $content$
        <div class="read-more">
          <a href="$url$" class="read-more-link">
            Read more..
          </a>
        </div>
      </div>
    </article>
  </script>
  <script type="text/html" id="no-search-result">
    <div class="no-result">
      <h2>No result found!</h2>
    </div>
  </script>
  <script type="text/javascript" src="/js/src/search.js?v=2.4.x"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  </body>
</html>
