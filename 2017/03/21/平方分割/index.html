
<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>平方分割 | 清逸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述
平方分割又叫做分桶法或者分块法，把排成一排的 $N$ 个元素每 $\sqrt N $ 分在一个块（桶）里，这样的分割方法可以把对区间的操作的复杂度降至 $O(\sqrt N)$。">
<meta property="og:type" content="article">
<meta property="og:title" content="平方分割">
<meta property="og:url" content="https://sea96.github.io/2017/03/21/平方分割/index.html">
<meta property="og:site_name" content="清逸">
<meta property="og:description" content="概述
平方分割又叫做分桶法或者分块法，把排成一排的 $N$ 个元素每 $\sqrt N $ 分在一个块（桶）里，这样的分割方法可以把对区间的操作的复杂度降至 $O(\sqrt N)$。">
<meta property="og:updated_time" content="2017-05-13T01:04:15.765Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="平方分割">
<meta name="twitter:description" content="概述
平方分割又叫做分桶法或者分块法，把排成一排的 $N$ 个元素每 $\sqrt N $ 分在一个块（桶）里，这样的分割方法可以把对区间的操作的复杂度降至 $O(\sqrt N)$。">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>
<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">清逸</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="sea96.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-平方分割" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/21/平方分割/" class="article-date">
  <time datetime="2017-03-21T12:02:57.000Z" itemprop="datePublished">2017-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/算法总结/">算法总结</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      平方分割
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><hr>
<p>平方分割又叫做分桶法或者分块法，把排成一排的 $N$ 个元素每 $\sqrt N $ 分在一个块（桶）里，这样的分割方法可以把对区间的操作的复杂度降至 $O(\sqrt N)$。</p>
<a id="more"></a>
<h2 id="对序列平方分割"><a href="#对序列平方分割" class="headerlink" title="对序列平方分割"></a>对序列平方分割</h2><hr>
<p>一般的做法是预设一个整数$S$（$S=\lceil \sqrt {N} \rceil$），将序列分成$B（B=\lceil \frac{N}{S} \rceil）$块，每块$S$个元素。对于一个区间的操作分为块内操作和块间操作，块内的暴力求解，块间的高效求解（排序后二分，lazy标记，预处理，数据结构维护等）。</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//定义块号和块边界</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    belong<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">/</span> S<span class="token punctuation">;</span>
    L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> belong<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>S<span class="token punctuation">;</span>
    R<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>S<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//区间询问或区间修改</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>l<span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>r<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//need efficient algorithm</span>
        i <span class="token operator">=</span> R<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//just use brute force</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><h4 id="POJ-2104-K-th-Number"><a href="#POJ-2104-K-th-Number" class="headerlink" title="POJ 2104 K-th Number"></a><a href="http://poj.org/problem?id=2104" target="_blank" rel="external">POJ 2104 K-th Number</a></h4><h5 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h5><p>有$n$个数字，$m$次询问，询问$[l,r]$区间里第$k$大的数字。</p>
<h5 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h5><p>这题是主席树的经典题目，在本文中尝试用分块的方法求解。<br>对元素的位置分块，每块分别排好序，二分第$k$大的数字$v$，对于一个区间$[l,r]$查询小于$v$的个数分为块内查询和块间查询，块内元素一个一个判断是否小于$v$；块间用二分查找来统计小于$v$的个数。<br>二分复杂度：$O(logN)$，单次查询复杂度：$O(S+BlogS)$<br>总时间复杂度：$O(M(logN(S+BlogS)))$<br><a href="http://paste.ubuntu.com/24285945/" target="_blank" rel="external">code</a></p>
<h4 id="UVA-12003-Array-Transformer"><a href="#UVA-12003-Array-Transformer" class="headerlink" title="UVA 12003 Array Transformer"></a><a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=3154" target="_blank" rel="external">UVA 12003 Array Transformer</a></h4><h5 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h5><p>有一个数组$A[1,…,n]$和$m$条指令和一个数字$u$，每条指令形如$(l,r,v,p)$，统计出$A[l],A[l+1],…,A[r]$中严格小于$v$的元素的个数为$k$，然后把$A[p]$改为$\frac {u*k}{r-l+1}$。问变换后的最终数组。</p>
<h5 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h5><p>对元素的位置分块，每块分别排序。询问的操作同<code>POJ 2104</code>，修改的操作则在$p$所在的块里进行，因为修改后块内元素基本有序，所以用 <strong>插入排序</strong> 的方法使得被修改的元素移动到正确的位置。<br>单次修改的复杂度：$O(logS+S)$，单次查询的复杂度：$O(S+BlogS)$<br>总时间复杂度：$O(M(S+BlogS))$<br>类题：<a href="http://www.spoj.com/problems/RACETIME/en/" target="_blank" rel="external">SPOJ RACETIME Race Against Time</a><br><a href="http://paste.ubuntu.com/24225925/" target="_blank" rel="external">code</a></p>
<h5 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h5><p>若本题修改不是单点修改，而是区间修改，那么也没有必要重新全部排序：</p>
<blockquote>
<p>本来数组是有序的，现在把其中一部分加上了一个数，那么可以将原数组分为修改后的和没修改的两部分，每部分都是一个有序数组，可以在 $O(S )$  的时间内 <strong>归并排序</strong>。  ——《非常规大小分块算法初探》 徐明宽</p>
</blockquote>
<h4 id="BZOJ-2957-楼房重建"><a href="#BZOJ-2957-楼房重建" class="headerlink" title="BZOJ 2957 楼房重建"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2957" target="_blank" rel="external">BZOJ 2957 楼房重建</a></h4><h5 id="题意-2"><a href="#题意-2" class="headerlink" title="题意"></a>题意</h5><p>一个人在坐标(0,0)看楼房，楼房定义为$(x_i,y_i)$表示位置在$x_i$，高度为$y_i$。如果这栋楼房上任何一个高度大于0的点与(0,0)的连线没有与之前的线段相交，那么这栋楼房就被认为是可见的。起初所有楼房的高度都为0，有M次操作，每次修改某个楼房的高度，问每次操作结束后能从(0,0)看到多少栋楼房。</p>
<h5 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h5><p>如果一栋楼房可见，那么最高点$(x_i,y_i)$和(0,0)在x轴上的斜率一定大于前面所有的楼房，也就是要求斜率单调递增的序列的长度。<br>对楼房的位置分块，每个块维护斜率递增的序列。修改操作直接在某个块上重新计算斜率递增的序列（可以使用插入排序算法），查询操作在每个块里二分查找大于前一个块里的最大斜率的斜率，并更新当前最大斜率。<br>单次修改复杂度：$O(S)$，单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(BlogS+S))$<br><a href="http://paste.ubuntu.com/24226008/" target="_blank" rel="external">code</a></p>
<h4 id="HDOJ-4366-Successor"><a href="#HDOJ-4366-Successor" class="headerlink" title="HDOJ 4366 Successor"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4366" target="_blank" rel="external">HDOJ 4366 Successor</a></h4><h5 id="题意-3"><a href="#题意-3" class="headerlink" title="题意"></a>题意</h5><p>有$n$个人，编号为0的是老板，编号1到$n-1$是员工，每个员工只有一个上司，除老板为每个人有他的忠诚值和能力值。每次要解雇一个人的时候，从他的下属中选取能力值大于他的且忠诚值最高的一个，若不存在则输出-1。共$m$次询问，每次询问解雇编号为i的员工会选择哪个编号的员工顶替他。（所有询问都不相互影响）</p>
<h5 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h5><p>显然是一棵树，用DFS序得到编号的序列，每个点能知道子树在序列上对应的区间。对序列分块，每块的元素按照能力值排序，简单的dp求得能力值更大的后缀里忠诚值的最大值。块内查询逐个遍历，块间查询二分查找大于解雇员工的能力值的位置，从而得到最大的忠诚值，又因为忠诚值互不相同，所以能用map对应到员工的编号。<br>单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(BlogS))$<br><a href="http://paste.ubuntu.com/24226267/" target="_blank" rel="external">code</a></p>
<h4 id="BZOJ-2002-Bounce-弹飞绵羊"><a href="#BZOJ-2002-Bounce-弹飞绵羊" class="headerlink" title="BZOJ 2002 Bounce 弹飞绵羊"></a><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2002" target="_blank" rel="external">BZOJ 2002 Bounce 弹飞绵羊</a></h4><h5 id="题意-4"><a href="#题意-4" class="headerlink" title="题意"></a>题意</h5><p>有$n$个弹力装置，每个装置有一个弹力系数$k_i$，如果绵羊到达第$i$个装置，它会被弹到第$i+k_i$个装置。有$m$个操作，修改某个装置的弹力系数，或者询问从某个装置出发弹几次后会被弹飞。</p>
<h5 id="题解-4"><a href="#题解-4" class="headerlink" title="题解"></a>题解</h5><p>对装置的位置分块，预处理出每个块维护从块里每个位置出发要弹几次后弹出该块，以及弹出后到达的位置。修改操作直接在某个块上重新计算要维护的信息，查询操作利用每个块的信息可以$O(1)$跳出该块，累计次数和即可。<br>单次修改复杂度：$O(S)$，单次查询复杂度：$O(B)$<br>总时间复杂度：$O(M(S+B))$<br><a href="http://paste.ubuntu.com/24226169/" target="_blank" rel="external">code</a></p>
<h5 id="拓展-1"><a href="#拓展-1" class="headerlink" title="拓展"></a>拓展</h5><p>本题的加强版：<a href="http://codeforces.com/problemset/problem/13/E" target="_blank" rel="external">CodeForces 13E Holes</a><br>增加单点修改的操作以及询问最后被弹飞的位置。<br>做法类似，预处理中增加从块里每个位置出发最后弹出该块的位置<br><a href="http://paste.ubuntu.com/24286071/" target="_blank" rel="external">code</a></p>
<h4 id="CodeForces-551E-GukiZ-and-GukiZiana"><a href="#CodeForces-551E-GukiZ-and-GukiZiana" class="headerlink" title="CodeForces 551E GukiZ and GukiZiana"></a><a href="http://codeforces.com/problemset/problem/551/E" target="_blank" rel="external">CodeForces 551E GukiZ and GukiZiana</a></h4><h5 id="题意-5"><a href="#题意-5" class="headerlink" title="题意"></a>题意</h5><p>有$n$个数字，$m$次操作：1. $[l,r]$区间里的所有数字都增加$x$；2. 询问$[1,n]$里的最远点对$(i,j)$满足$a_i=a_j=y$。</p>
<h5 id="题解-5"><a href="#题解-5" class="headerlink" title="题解"></a>题解</h5><p>类似线段树的区间修改，对每一个块添加lazy标记表示该块统一增加的总和。每块分别把$pair(a[i],i)$排好序，若块内元素被修改则重新排序，询问时只要对所有的块二分$(y-lazy[b])$求出最近左端点和最远右端点即可。<br>单次修改复杂度：$O(SlogS+B)$，单次查询复杂度：$O(BlogS)$<br>总时间复杂度：$O(M(SlogS+BlogS))$<br><a href="http://paste.ubuntu.com/24286489/" target="_blank" rel="external">code</a></p>
<h4 id="CodeForces-444C-DZY-Loves-Colors"><a href="#CodeForces-444C-DZY-Loves-Colors" class="headerlink" title="CodeForces 444C DZY Loves Colors"></a><a href="http://codeforces.com/problemset/problem/444/C" target="_blank" rel="external">CodeForces 444C DZY Loves Colors</a></h4><h5 id="题意-6"><a href="#题意-6" class="headerlink" title="题意"></a>题意</h5><p>有$n$个数字，第$i$个数字$a[i]=i$，有$m$次操作：1. 修改$[l,r]$区间的数字为$x$，设原来的值为$y$，那么该位置改变量累加$|x-y|$；2. 询问$[l,r]$区间的改变量的总和。</p>
<h5 id="题解-6"><a href="#题解-6" class="headerlink" title="题解"></a>题解</h5><p>对每一个块设置lazy标记表示该块的相同的值（如果不相同则标记为0），$sum[i]$表示第i个数字非lazy修改（即直接单点修改）的改变量和，$sum_{lazy}[b]$表示第$b$块里每一个数字经lazy修改的改变量和，$sum_{block}[b]$表示第b块经lazy修改的所有数字的改变量总和。每次区间修改最多出现两个没有lazy标记的块，所以需要暴力单点更新的块不会很多。块内询问每个数字的贡献值总和：$\sum (sum[i]+sum_{lazy}[b])$；块间询问每个块的贡献值总和：$\sum sum_{block}[b]$。<br>单次修改复杂度：$O(S+B)$，单次查询复杂度：$O(S+B)$<br>总时间复杂度：$O(M(S+B))$<br><a href="http://paste.ubuntu.com/24286192/" target="_blank" rel="external">code</a></p>
<h4 id="CodeChef-QCHEF-Chef-and-Problems"><a href="#CodeChef-QCHEF-Chef-and-Problems" class="headerlink" title="CodeChef QCHEF Chef and Problems"></a><a href="https://www.codechef.com/problems/QCHEF" target="_blank" rel="external">CodeChef QCHEF Chef and Problems</a></h4><h5 id="题意-7"><a href="#题意-7" class="headerlink" title="题意"></a>题意</h5><p>有$N$个数字，第$i$个数字$A[i] \leq M$，$K$次询问：问在$[L,R]$中相同数字的位置的最大间隔。</p>
<h5 id="题解-7"><a href="#题解-7" class="headerlink" title="题解"></a>题解</h5><p>由于没有修改操作，可以预处理一些信息来辅助求解。<br>对序列分块之后进行预处理：<br>块间预处理：$ans[i][j]$表示第$i$块到第$j$块区间里的最大间隔，通过$pre$数组记录每个数字最早出现的位置实现。然后就可以$O(1)$得到块间最大值。<br>块内预处理：$pos_0[b][v]$表示第$b$块里$v$最后出现的位置，然后转为前$b$块的最后出现的位置；同理可得$pos_1[b][v]$表示第$b$块之后$v$最早出现的位置。然后暴力求解即可，求解方法和块间预处理相同。<br>块间预处理复杂度：$O(BN)$，块内预处理复杂度：$O(N+BM)$<br>总时间复杂度：$O(BN+BM+KS)$<br><a href="http://paste.ubuntu.com/24497476/" target="_blank" rel="external">code</a><br>类题：<a href="http://www.spoj.com/problems/ZQUERY/en/" target="_blank" rel="external">SPOJ ZQUERY Zero Query</a>（提示：求前缀和）</p>
<h4 id="LYOI-147-「分块」区间众数"><a href="#LYOI-147-「分块」区间众数" class="headerlink" title="LYOI 147 「分块」区间众数"></a><a href="https://ly.men.ci/problem/147" target="_blank" rel="external">LYOI 147 「分块」区间众数</a></h4><h5 id="题意-8"><a href="#题意-8" class="headerlink" title="题意"></a>题意</h5><p>给一个长度为 $n$ 的序列，$m$ 次询问，每次查询一个区间 $[l,r]$ 内的众数（如果有多个众数，取最小的一个），强制在线。</p>
<h5 id="题解-8"><a href="#题解-8" class="headerlink" title="题解"></a>题解</h5><p>同样没有修改操作，类似上题预处理一些信息。<br>对序列离散化，分块之后进行预处理：<br>块间预处理：$ans[i][j]$表示第$i$块到第$j$块区间的众数，通过$cnt$数组记录每个数字出现次数实现。然后就可以$O(1)$得到块间最大值。<br>块内预处理：$sum[b][v]$表示第$b$块里$v$出现的次数，然后转为前$b$块的出现的次数。然后暴力求解即可，求解方法和块间预处理相同。<br>块间预处理复杂度：$O(BN)$，块内预处理复杂度：$O(N+BN)$<br>总时间复杂度：$O(BN+S)$<br><a href="http://paste.ubuntu.com/24497549/" target="_blank" rel="external">code</a></p>
<h5 id="拓展-2"><a href="#拓展-2" class="headerlink" title="拓展"></a>拓展</h5><p>带修改操作：<a href="http://www.docin.com/p-679227660.html" target="_blank" rel="external">区间众数解题报告 - 陈立杰</a></p>
<h4 id="CodeForces-455D-Serega-and-Fun"><a href="#CodeForces-455D-Serega-and-Fun" class="headerlink" title="CodeForces 455D Serega and Fun"></a><a href="http://codeforces.com/problemset/problem/455/D" target="_blank" rel="external">CodeForces 455D Serega and Fun</a></h4><h5 id="题意-9"><a href="#题意-9" class="headerlink" title="题意"></a>题意</h5><p>有 $n$ 个数字，$q$ 次操作，1. 序列循环向右移动一位；2. 询问 $[l,r]$ 里 $k$ 的个数。强制在线。</p>
<h5 id="题解-9"><a href="#题解-9" class="headerlink" title="题解"></a>题解</h5><p>使用块状链表解决：<br>用<code>deque</code>或者<code>list</code>存储每块的元素，移位操作在每块 $O(1)$ 地插入或删除。<br>预处理出每块中每个元素的个数，移位时也可以 $O(1)$ 修改。<br>总时间复杂度：$O(Q(B+S))$<br><a href="http://paste.ubuntu.com/24502543/" target="_blank" rel="external">code</a></p>
<h4 id="HDU-4391-Paint-The-Wall"><a href="#HDU-4391-Paint-The-Wall" class="headerlink" title="HDU 4391 Paint The Wall"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4391" target="_blank" rel="external">HDU 4391 Paint The Wall</a></h4><h5 id="题意-10"><a href="#题意-10" class="headerlink" title="题意"></a>题意</h5><p>有 $n$ 个数字，$q$ 次操作，1. 将 $[l,r]$ 里的所有元素涂成颜色 $z$；2. 询问 $[l,r]$ 里 颜色 $z$ 的个数。</p>
<h5 id="题解-10"><a href="#题解-10" class="headerlink" title="题解"></a>题解</h5><p>颜色范围很大，如果使用朴素的线段树空间上无法承受。<br>线段树套分块哈希：考虑线段树维护的不是单个元素，而是整块元素，每块用 <code>map</code> 维护每种颜色的数量，再加上懒惰标记后可以通过此题。<br>总时间复杂度：$O(Q(B+SlogS)$<br><a href="http://paste.ubuntu.com/24502639/" target="_blank" rel="external">code</a></p>
<h2 id="对集合平方分割"><a href="#对集合平方分割" class="headerlink" title="对集合平方分割"></a>对集合平方分割</h2><hr>
<p>通常在图中使用，具体做法是预设一个整数$S$（$S=\lceil \sqrt {E} \rceil$），将度数超过 $S$ 的点记为<strong>重点</strong>，其余的点记为<strong>轻点</strong>。重新建图：<strong>重点</strong>只与相邻的<strong>重点</strong>连边，<strong>重点</strong>与相邻的<strong>轻点</strong>的边的信息使用预处理或者数据结构等手段高效维护，使得对点的遍历和边的修改的复杂度降至 $O(\sqrt E)$。</p>
<h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><h4 id="HDU-4858-项目管理"><a href="#HDU-4858-项目管理" class="headerlink" title="HDU 4858 项目管理"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4858" target="_blank" rel="external">HDU 4858 项目管理</a></h4><h5 id="题意-11"><a href="#题意-11" class="headerlink" title="题意"></a>题意</h5><p>有 $n$ 个点，$m$ 条边的无向无环图，两个节点可能有多条边，每条点有权值，有 $q$ 次操作，1. 节点 $u$ 的权值加上 $v$；2. 问节点 $u$ 相邻点的权值和。</p>
<h5 id="题解-11"><a href="#题解-11" class="headerlink" title="题解"></a>题解</h5><p>根据<strong>重点</strong>和<strong>轻点</strong>的定义，将原图重新建图，若 $u$ 是重点，$sum[u]$ 保存与 $u$ 相邻的 <strong>重点</strong> 的权值和。修改 <strong>重点</strong> 的话更新该点和与该点相邻的 <strong>重点</strong> 的$sum$（单次修改复杂度：$O(S)$；单次查询复杂度：$O(1)$），否则在原图遍历所有相邻点的 $sum$（单次修改复杂度：$O(S)$；单次查询复杂度：$O(S)$）。<br>总时间复杂度：$O(QS)$<br><a href="http://paste.ubuntu.com/24554157/" target="_blank" rel="external">code</a></p>
<h4 id="HDU-4467-Graph"><a href="#HDU-4467-Graph" class="headerlink" title="HDU 4467 Graph"></a><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4467" target="_blank" rel="external">HDU 4467 Graph</a></h4><h5 id="题意-12"><a href="#题意-12" class="headerlink" title="题意"></a>题意</h5><p>有 $n$ 个点，$m$ 条边的无向无环图，每条边有权值 $w$，每个点有颜色 $(0/1)$，有 $q$ 次操作，1. 第 $x$ 个点的颜色反转；2. 问端点的颜色是 $(A,B)$ 的边的权值和。（$A(B)=0/1$）</p>
<h5 id="题解-12"><a href="#题解-12" class="headerlink" title="题解"></a>题解</h5><p>根据<strong>重点</strong>和<strong>轻点</strong>的定义，将原图重新建图，预处理若干信息，若 $u$ 是 <strong>重点</strong>，$sum[u][0/1]$ 保存与 $u$ 相邻的 <strong>重点（轻）点</strong> 的边权和，$ans[k]$(k=0: <code>0-0</code>; k=1: <code>0-1</code>; k=2: <code>1-1</code>) 保存统一类型的边权总和，修改只要交换信息即可，查询能 $O(1)$ 得到答案。<br><a href="http://paste.ubuntu.com/24523491/" target="_blank" rel="external">code</a></p>
<h4 id="ZOJ-3749-Chameleon"><a href="#ZOJ-3749-Chameleon" class="headerlink" title="ZOJ 3749 Chameleon"></a><a href="http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemCode=3749" target="_blank" rel="external">ZOJ 3749 Chameleon</a></h4><h5 id="题意-13"><a href="#题意-13" class="headerlink" title="题意"></a>题意</h5><p>有 $n$ 个集合，第 $i$ 个集合有 $m_i$ 个数字，所有数字都不相同，$q$ 次操作，每次选取第 $i$ 个集合和第 $j$ 个集合，按照数字大小归并排序，问排序后相邻数字之间所属集合不同的个数。</p>
<h5 id="题解-13"><a href="#题解-13" class="headerlink" title="题解"></a>题解</h5><p>按照朴素的方法，复杂度是 $O(QN)$。按照集合的大小以 $S=\sqrt N$ 分类，两个集合都小于 $S$ 的询问按照朴素的方法解决，复杂度为 $O(QS)$；如果大于$S$，考虑离线询问，对于一个大于 $S$ 的集合，$O(N)$ 处理出其他所有集合和它的答案，那么复杂度为 $O(NS)$。总时间复杂度：$O((N+Q)S)$<br><a href="http://paste.ubuntu.com/24557908/" target="_blank" rel="external">code</a></p>
<p>CodeForces 348C     Subset Sums 对集合<br>CodeForces 576C     Points on Plane 对集合<br>CodeForces 398D Instant Messanger 对集合</p>
<h2 id="对询问平方分割"><a href="#对询问平方分割" class="headerlink" title="对询问平方分割"></a>对询问平方分割</h2><hr>
<p>莫队算法用到了分块的思想，一般是给$Q$个区间$[l,r]$来进行的一些操作和询问。<br>将序列分成$\sqrt N $块，每块的大小为$\sqrt N $。离线处理$Q$个区间：首先对左端点$l$所在的块号从小到大排序，如果块号相同则按右端点$r$从小到大排序。然后用双指针移动到当前区间位置，每次移动更新对结果的贡献。</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>Q<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>L <span class="token operator">&lt;</span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">)</span> <span class="token function">sub</span><span class="token punctuation">(</span>L<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//删除</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>L <span class="token operator">></span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">--</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//增加</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>R <span class="token operator">&lt;</span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">++</span>R<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>R <span class="token operator">></span> q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token function">sub</span><span class="token punctuation">(</span>R<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ans<span class="token punctuation">[</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//答案</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="http://codeforces.com/contest/86/problem/D" target="_blank" rel="external">CF 86D Powerful array</a></p>
<p>CodeForces 351D Jeff and Removing Periods 莫队<br>HDU 4638 Group 莫队<br>CodeForces 103D Time to Raid Cowavans 莫队<br>CodeForces 375D Tree and Queries  莫队<br>CodeForces 617E    XOR and Favorite Number 莫队<br>SPOJ DQUERY    D-query 莫队<br>CodeChef GERALD07 Chef and Graph Queries 莫队，并查集，LCT<br>CodeChef IITI15    Sherlock and Inversions 莫队，区间逆序对</p>
<p>分块大法好！</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://sea96.github.io/2017/03/21/平方分割/" data-id="cj2mw7ngy002naguv4lqscbxz" class="article-share-link" data-share="baidu" data-title="平方分割">Share</a>
      

      
        <a href="https://sea96.github.io/2017/03/21/平方分割/#disqus_thread" class="article-comment-link">Comments</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/平方分割/">平方分割</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/23/Egyptian-Collegiate-Programming-Contest-ECPC-2015/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Egyptian Collegiate Programming Contest (ECPC 2015)
        
      </div>
    </a>
  
  
    <a href="/2017/03/20/AtCoder-Regular-Contest-070/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">AtCoder Regular Contest 070</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ACM解题报告/">ACM解题报告</a><span class="category-list-count">26</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ACM解题报告/套题/">套题</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ACM解题报告/散题/">散题</a><span class="category-list-count">17</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法总结/">算法总结</a><span class="category-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/DFS/" style="font-size: 12.5px;">DFS</a> <a href="/tags/LCS/" style="font-size: 10px;">LCS</a> <a href="/tags/STL/" style="font-size: 11.25px;">STL</a> <a href="/tags/二分/" style="font-size: 18.75px;">二分</a> <a href="/tags/二叉树/" style="font-size: 10px;">二叉树</a> <a href="/tags/伸展树/" style="font-size: 10px;">伸展树</a> <a href="/tags/位运算/" style="font-size: 13.75px;">位运算</a> <a href="/tags/动态规划/" style="font-size: 20px;">动态规划</a> <a href="/tags/博弈/" style="font-size: 11.25px;">博弈</a> <a href="/tags/图论/" style="font-size: 16.25px;">图论</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/平方分割/" style="font-size: 10px;">平方分割</a> <a href="/tags/并查集/" style="font-size: 10px;">并查集</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/数学/" style="font-size: 13.75px;">数学</a> <a href="/tags/数据结构/" style="font-size: 16.25px;">数据结构</a> <a href="/tags/数论/" style="font-size: 15px;">数论</a> <a href="/tags/最短路/" style="font-size: 10px;">最短路</a> <a href="/tags/构造/" style="font-size: 12.5px;">构造</a> <a href="/tags/树的直径/" style="font-size: 10px;">树的直径</a> <a href="/tags/概率/" style="font-size: 12.5px;">概率</a> <a href="/tags/线段树/" style="font-size: 10px;">线段树</a> <a href="/tags/组合数学/" style="font-size: 13.75px;">组合数学</a> <a href="/tags/莫队算法/" style="font-size: 10px;">莫队算法</a> <a href="/tags/贪心/" style="font-size: 17.5px;">贪心</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/13/快速傅里叶变换/">快速傅里叶变换</a>
          </li>
        
          <li>
            <a href="/2017/05/05/后缀数组/">后缀数组</a>
          </li>
        
          <li>
            <a href="/2017/04/20/单调栈/">单调栈</a>
          </li>
        
          <li>
            <a href="/2017/04/11/Codeforces-Round-406-Div-2/">Codeforces Round #406 (Div. 2)</a>
          </li>
        
          <li>
            <a href="/2017/04/09/初等数论/">初等数论</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://github.com/sea96" target="_blank">Github</a>
          </li>
        
          <li>
            <a href="http://www.cnblogs.com/Running-Time/" target="_blank">Old Blog</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 清逸<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="totop"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<script>
  var disqus_shortname = 'harrypoker';
  
  var disqus_url = 'https://sea96.github.io/2017/03/21/平方分割/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<script src="/js/script.js"></script>

</div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
